<div class="dashboard-container">
  <div class="dashboard-card">
    <div class="header">
      <h1>Welcome!</h1>
      <button (click)="logout()" class="logout-btn">Logout</button>
    </div>

    <div *ngIf="isLoading" class="loading">
      Loading...
    </div>

    <div *ngIf="!isLoading && user" class="welcome-content">
      <div class="welcome-message">
        <h2>Hello, {{ user.firstName }}!</h2>
        <p class="welcome-text">Welcome to Napkin. You're successfully logged in.</p>
      </div>
      
      <!-- Show welcome message and Create Company button for members or users with no companies -->
      <div *ngIf="userCompanies.length === 0" class="actions-section">
        <p class="welcome-join-text">Welcome! Join a team or create your own company to get started.</p>
        <button (click)="openCreateCompanyModal()" class="btn-create-company">Create Company</button>
        <p class="hint-text">Create a company to become a team Admin and invite team members</p>
      </div>

      <!-- Show welcome message for members who have companies but are not admin -->
      <div *ngIf="userCompanies.length > 0 && !hasAdminRole()" class="actions-section">
        <p class="welcome-join-text">Welcome! You're a member of {{ userCompanies.length }} company(ies).</p>
        <button (click)="openCreateCompanyModal()" class="btn-create-company">Create Your Own Company</button>
        <p class="hint-text">Create your own company to become a team Admin</p>
      </div>

      <!-- Show Companies section for users who have companies -->
      <div *ngIf="userCompanies.length > 0" class="companies-section">
        <div class="section-header">
          <h3>My Companies</h3>
        </div>
        
        <div class="companies-list">
          <div *ngFor="let company of userCompanies" class="company-card">
            <div class="company-info">
              <h4>{{ company.name }}</h4>
              <p *ngIf="company.description" class="company-description">{{ company.description }}</p>
              <p class="company-meta">Members: {{ company.members?.length || 0 }}</p>
              <!-- Show user's role in this company -->
              <p class="company-role" *ngIf="getUserRoleInCompany(company)">
                Your Role: <strong>{{ getUserRoleInCompany(company) | titlecase }}</strong>
              </p>
            </div>
            <div class="company-actions">
              <button (click)="goToCompanyAdmin(company.companyId)" class="btn-view-company">View Company</button>
              <button *ngIf="canInviteInCompany(company)" (click)="openInviteModal(company.companyId)" class="btn-invite">Invite User</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Company Modal -->
  <div *ngIf="showCreateCompanyModal" class="modal-overlay" (click)="closeCreateCompanyModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>Create New Company</h3>
      <div class="modal-body">
        <form (ngSubmit)="createCompany()" #companyForm="ngForm">
          <div class="form-group">
            <label for="company-name">Company Name: *</label>
            <input 
              type="text" 
              id="company-name" 
              name="companyName"
              [(ngModel)]="newCompany.name" 
              class="form-control" 
              required
              minlength="2"
              maxlength="100">
          </div>

          <div class="form-group">
            <label for="company-description">Description:</label>
            <textarea 
              id="company-description" 
              name="description"
              [(ngModel)]="newCompany.description" 
              class="form-control" 
              rows="4"
              maxlength="500"></textarea>
          </div>

          <div class="modal-actions">
            <button type="button" (click)="closeCreateCompanyModal()" class="btn-cancel">Cancel</button>
            <button type="submit" [disabled]="!companyForm.valid || isCreatingCompany" class="btn-save">
              {{ isCreatingCompany ? 'Creating...' : 'Create Company' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Invite User Modal -->
  <div *ngIf="showInviteModal" class="modal-overlay" (click)="closeInviteModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>Invite User to Company</h3>
      <div class="modal-body">
        <form (ngSubmit)="inviteUser()" #inviteForm="ngForm">
          <div class="form-group">
            <label for="invite-email">Email Address: *</label>
            <input 
              type="email" 
              id="invite-email" 
              name="email"
              [(ngModel)]="inviteData.email" 
              class="form-control" 
              required
              email>
            <p class="form-hint">Enter the email address of the user you want to invite</p>
          </div>

          <div class="modal-actions">
            <button type="button" (click)="closeInviteModal()" class="btn-cancel">Cancel</button>
            <button type="submit" [disabled]="!inviteForm.valid || isInviting" class="btn-save">
              {{ isInviting ? 'Sending...' : 'Send Invite' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

